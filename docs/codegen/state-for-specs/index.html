<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">State in Specs | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/codegen/state-for-specs/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="State in Specs | Litho"><meta data-react-helmet="true" name="description" content="This page covers the old Java Spec API. If you aren&#x27;t using the Spec API, please refer to Introduction to Hooks."><meta data-react-helmet="true" property="og:description" content="This page covers the old Java Spec API. If you aren&#x27;t using the Spec API, please refer to Introduction to Hooks."><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/codegen/state-for-specs/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/codegen/state-for-specs/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/codegen/state-for-specs/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.8e434651.js" as="script">
<link rel="preload" href="/assets/js/main.c921d0e3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Visibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adopting Litho</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Codegen APIs</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/layout-specs/">Layout Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/mount-specs/">Mount Specs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Passing Data To Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/codegen/state-for-specs/">State in Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/events-for-specs/">Events for Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codegen/trigger-events/">Triggering events with Handles</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tooling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">State in Specs</h1></header><div class="markdown"><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This page covers the old Java Spec API. If you aren&#x27;t using the Spec API, please refer to <a href="/docs/mainconcepts/hooks-intro/">Introduction to Hooks</a>.</p></div></div><p>This page introduces the concept of state in a component written using the Java Spec API, namely a <code>@LayoutSpec</code> or <code>@MountSpec</code>.</p><p>A component can have two types of data:</p><ul><li><strong>Props</strong> - passed down from the parent and cannot change during a component&#x27;s lifecycle.</li><li><strong>State</strong> - State data is encapsulated and managed within the component and is transparent to the parent.</li></ul><p>This page uses the example of a <code>Counter</code> component, in which you can click a button to increase or decrease a value. The example helps you to learn how to use State to make the <code>Counter</code> component reusable and encapsulated; it provides an overview of adding state to a component.</p><p>You can start by encapsulating how the <code>Counter</code> looks:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CounterComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @Prop int count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;+&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;&quot; + count))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;-&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>Counter</code> component is missing a crucial feature, which is interacting with the buttons to update the count value.</p><p>Ideally, you&#x27;d want this component to encapsulate all this behaviour in its internal implementation, which would mean you&#x27;d write it once then reuse it anywhere you need a counter, as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">final CounterComponent counter = CounterComponent.create().build();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To implement this, you need to add &#x27;state&#x27; to the <code>Counter</code> component.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="adding-local-state-to-a-component">Adding Local State to a Component<a aria-hidden="true" class="hash-link" href="#adding-local-state-to-a-component" title="Direct link to heading">â€‹</a></h2><p>You can change the <code>counter</code> from prop to state in three steps:</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-replace-the-counter-prop-declaration-with-a-state-declaration">1. Replace the <code>counter</code> prop declaration with a state declaration<a aria-hidden="true" class="hash-link" href="#1-replace-the-counter-prop-declaration-with-a-state-declaration" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CounterComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State int count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-set-an-initial-value-for-the-count-state">2. Set an initial value for the <code>count</code> state<a aria-hidden="true" class="hash-link" href="#2-set-an-initial-value-for-the-count-state" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateInitialState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onCreateInitialState(ComponentContext c, StateValue&lt;Integer&gt; count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count.set(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="3-use-the-state-value">3. Use the state value<a aria-hidden="true" class="hash-link" href="#3-use-the-state-value" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State int count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;+&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;&quot; + count))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;-&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="updating-state">Updating State<a aria-hidden="true" class="hash-link" href="#updating-state" title="Direct link to heading">â€‹</a></h2><p>Next, you&#x27;ll make the Counter component update the count value when the increase or decrease buttons are clicked, in two steps:</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="1-set-click-handlers-on-the-buttons">1. Set click handlers on the buttons<a aria-hidden="true" class="hash-link" href="#1-set-click-handlers-on-the-buttons" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State int count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;+&quot;).clickHandler(CounterComponent.onClickIncrease(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;&quot; + count))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;-&quot;).clickHandler(CounterComponent.onClickDecrease(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onClickIncrease(ComponentContext c) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onClickDecrease(ComponentContext c) {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="2-update-the-state-value-in-the-click-handlers">2. Update the state value in the click handlers<a aria-hidden="true" class="hash-link" href="#2-update-the-state-value-in-the-click-handlers" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CounterComponentSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateInitialState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onCreateInitialState(ComponentContext c, StateValue&lt;Integer&gt; count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count.set(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @State int count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Row.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;+&quot;).clickHandler(CounterComponent.onClickIncrease(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;&quot; + count))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c).text(&quot;-&quot;).clickHandler(CounterComponent.onClickDecrease(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onClickIncrease(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CounterComponent.increase(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onClickDecrease(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CounterComponent.decrease(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void increase(StateValue&lt;Integer&gt; count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count.set(count.get() + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void decrease(StateValue&lt;Integer&gt; count) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count.set(count.get() - 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="state-api-reference-and-considerations">State API Reference and Considerations<a aria-hidden="true" class="hash-link" href="#state-api-reference-and-considerations" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="data-immutability">Data Immutability<a aria-hidden="true" class="hash-link" href="#data-immutability" title="Direct link to heading">â€‹</a></h3><p>Due to background layout, state can be accessed anytime by multiple threads. To ensure thread safety, state objects should be immutable (if for some rare reason this is not possible, then at least thread safe). The simplest solution is to express your state in terms of primitives since primitives are, by definition, immutable.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="component-identity">Component Identity<a aria-hidden="true" class="hash-link" href="#component-identity" title="Direct link to heading">â€‹</a></h3><p>Litho uses keys to keep track of component identity between layout changes and correctly identify a component as the target of a state update. For more information on how the component identity functions, see the <a href="/docs/mainconcepts/coordinate-state-actions/keys-and-identity/">Keys and Component Identity</a> page.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="initialising-state-values">Initialising State Values<a aria-hidden="true" class="hash-link" href="#initialising-state-values" title="Direct link to heading">â€‹</a></h3><p>State initialisation is guaranteed to happen once and only once for a component based on its <a href="/docs/mainconcepts/coordinate-state-actions/keys-and-identity/">identity</a>, even if there are multiple threads attempting to calculate the layout for the same component in parallel.</p><p>In the Java API, the method annotated with <code>@OnCreateInitialState</code> is guaranteed to be called just once during a component&#x27;s lifecycle.</p><p>This is an important consideration that you should keep in mind when you use prop values to initialize state. Passing new props to a component does not call the initializer again; a state value can only be updated after it was initialized by using the <a href="/docs/codegen/state-for-specs/#updating-state">state update APIs</a>.</p><p>In the Java API, to set an initial value for a state, you have to write a method annotated with <code>@OnCreateInitialState</code> in your spec.
The following are points to keep in mind when writing an <code>@OnCreateInitialState</code> method:</p><ul><li>The first parameter must be of type <code>ComponentContext</code>.</li><li><code>@Prop</code> parameters are allowed, but <code>@OnCreateInitialState</code> methods are not called again if the props change.</li><li>All other parameters must have a corresponding parameter annotated with <code>@State</code> in the other lifecycle methods, and their type must be a <a href="/javadoc/com/facebook/litho/StateValue.html" target="_blank" rel="noopener noreferrer">StateValue</a> that is parameterized with the type of the matching <code>@State</code> element.</li><li>Initializing a state value is not mandatory and implementing an <code>@OnCreateInitialState</code> method can be entirely skipped. If a state value is not explicitly initialised, the initial state is assigned the default value of its inferred type. For example, <code>0</code> for integer state, <code>false</code> for Boolean state or <code>null</code> for Objects.</li><li>You should never need to call the <code>@OnCreateInitialState</code> method yourself.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="updating-state-values">Updating State Values<a aria-hidden="true" class="hash-link" href="#updating-state-values" title="Direct link to heading">â€‹</a></h3><p>Every state update triggers a new layout calculation for its <code>ComponentTree</code>. Passing new props to a Litho component and updating the state are implemented in the same way in Litho, so there is no performance difference. To understand when you should update a Component using new props or updating state, see the <a href="/docs/best-practices/props-vs-state/">Props vs. State</a> page.</p><p>However, Litho implements a feature called reconciliation, which attempts to detect what part of the <code>ComponentTree</code> is affected by that state update and reuse the layout for the nodes that don&#x27;t need to change.
State updates can be performed synchronously on the same thread that they were triggered from, or asynchronously from Litho&#x27;s background thread.</p><p>The following points should be kept in mind when updating a state value:</p><ul><li>Avoid calling state update methods in the <code>@OnCreateLayout</code> method of a component. Every state update method triggers a new layout calculation, which re-invokes the render method of the component that triggered the state update. This can easily lead to an infinite loop. You should consider whether a <a href="#lazy-state">lazy state</a> update would be more appropriate for your use case, and only use state updates in a render method if you&#x27;re absolutely certain that the state update is conditionally called and can only be triggered a limited number of times.</li><li>In <a href="/docs/codegen/mount-specs/">MountSpecs</a>, state updates are not allowed in <code>bind</code> and <code>mount</code> methods as they cause a runtime exception if used. If you need to update a state value in those methods, you should instead use a <a href="#lazy-state">lazy state</a> update.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the Java API, you can define how a component&#x27;s state or states should be updated by declaring methods annotated with <code>@OnUpdateState</code> in the specs. You can have as many <code>@OnUpdateState</code> methods as you need, according to what states you want to update or what parameters your states depend on.</p><p>The following points should be considered when writing an <code>@OnUpdateState</code> method:</p><ul><li>Parameters representing the state values must match the name of a parameter annotated with <code>@State</code> and used in other lifecycle methods, and their type must be a <code>StateValue</code> parameterized with the type of the matching <code>@State</code>.</li><li><code>@Prop</code>s are not allowed, but <code>@Param</code> parameters are. If the value of your state depends on props, you can pass them as <code>@Param</code> params from the lifecycle methods that call the state update methods. For each <code>@OnUpdateState</code> method in your spec, the generated component has two methods that delegate to the <code>@OnUpdateStUpdate the state value in the click handlerate</code> method under the hood:</li><li>A static method with the same name, which asynchronously applies the state updates.</li><li>A static method with the same name and a <em>Sync</em> suffix, which synchronously triggers the state updates. Both methods take a <code>ComponentContext</code> as first parameter, followed by all the parameters declared with <code>@Param</code> in your <code>@OnUpdateState</code> method.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="lazy-state">Lazy State<a aria-hidden="true" class="hash-link" href="#lazy-state" title="Direct link to heading">â€‹</a></h2><p>For situations where you want to update the value of a state but don&#x27;t need to immediately trigger a new layout calculation, you can use <strong>lazy state updates</strong>. After a lazy state update, the new state value is visible in event handlers, but a new layout is not triggered.
Currently, the value is immediately visible to the event handler but <strong>not</strong> visible to other lifecycle callbacks (such as <code>onMount</code>).</p><p>Lazy state is useful for updating state values that don&#x27;t need to be reflected in the UI. For example, say you want to log an analytics event only the first time a component becomes visible. If you use lazy state, you can record whether a log was sent in a lazy state variable without causing the UI to reflow.</p><p>Lazy state can still be used for regular state updates.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnEvent(VisibleEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onClickEvent(ComponentContext c, @State(canUpdateLazily = true) boolean logOnce) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!logOnce) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // do some logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IdentityRootComponent.lazyUpdateLogOnce(c, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/codegen/state-for-specs.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/codegen/passing-data-to-components/treeprops/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->TreeProps</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/codegen/events-for-specs/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Events for Specs<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adding-local-state-to-a-component" class="table-of-contents__link toc-highlight">Adding Local State to a Component</a><ul><li><a href="#1-replace-the-counter-prop-declaration-with-a-state-declaration" class="table-of-contents__link toc-highlight">1. Replace the <code>counter</code> prop declaration with a state declaration</a></li><li><a href="#2-set-an-initial-value-for-the-count-state" class="table-of-contents__link toc-highlight">2. Set an initial value for the <code>count</code> state</a></li><li><a href="#3-use-the-state-value" class="table-of-contents__link toc-highlight">3. Use the state value</a></li></ul></li><li><a href="#updating-state" class="table-of-contents__link toc-highlight">Updating State</a><ul><li><a href="#1-set-click-handlers-on-the-buttons" class="table-of-contents__link toc-highlight">1. Set click handlers on the buttons</a></li><li><a href="#2-update-the-state-value-in-the-click-handlers" class="table-of-contents__link toc-highlight">2. Update the state value in the click handlers</a></li></ul></li><li><a href="#state-api-reference-and-considerations" class="table-of-contents__link toc-highlight">State API Reference and Considerations</a><ul><li><a href="#data-immutability" class="table-of-contents__link toc-highlight">Data Immutability</a></li><li><a href="#component-identity" class="table-of-contents__link toc-highlight">Component Identity</a></li><li><a href="#initialising-state-values" class="table-of-contents__link toc-highlight">Initialising State Values</a></li><li><a href="#updating-state-values" class="table-of-contents__link toc-highlight">Updating State Values</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8e434651.js"></script>
<script src="/assets/js/main.c921d0e3.js"></script>
</body>
</html>