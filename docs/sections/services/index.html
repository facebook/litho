<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Advanced: Granular Dependency Injection | Litho</title><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/sections/services"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Advanced: Granular Dependency Injection | Litho"><meta data-react-helmet="true" name="description" content="Values such as @Prop flow through Sections before being rendered on screen. The Sections API sits between your data source and the UI Component to efficiently calculate the changesets you need to render your components. For better performance we should only do work at the layer where it is required."><meta data-react-helmet="true" property="og:description" content="Values such as @Prop flow through Sections before being rendered on screen. The Sections API sits between your data source and the UI Component to efficiently calculate the changesets you need to render your components. For better performance we should only do work at the layer where it is required."><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/sections/services"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/sections/services" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/sections/services" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7fecd722.css">
<link rel="preload" href="/assets/js/runtime~main.c13abd95.js" as="script">
<link rel="preload" href="/assets/js/main.f78999c6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Building lists</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/start">Basics: DiffSection and GroupSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/recycler-collection-component">Adding and adapting RecyclerCollection to your App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/best-practices">Best Practices and Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/hscrolls">Nested scrolling and measurement</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/api-overview">API üìÑ: annotations, events and lifecycles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/working-ranges">Advanced: Prefetch and pagination</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/sections/services">Advanced: Granular Dependency Injection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/view-support">Advanced: Mixing with Android Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/diff-sections">Advanced: Writing your own DiffSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/sections/architecture">Internal üèó: Sections implementation architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deep Dive</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributing Documentation</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Advanced: Granular Dependency Injection</h1></header><div class="markdown"><p>Values such as <code>@Prop</code> flow through Sections before being rendered on screen. The Sections API sits between your data source and the UI Component to efficiently calculate the changesets you need to render your components. For better performance we should only do work at the layer where it is required.</p><p>Thus, the data should ideally be fetched only in the Sections that use it. You need for those <strong>data fetchers to be available throughout your Sections hierarchy</strong> without having to cumbersomely pass them through each of the layers, and even through <code>GroupSection</code> that don&#x27;t use it directly.</p><p>This is where Services come in.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><p>Services are what sections use to control your data source imperatively. It is through the service APIs where the <a href="/javadoc/com/facebook/litho/sections/SectionLifecycle.html" target="_blank" rel="noopener noreferrer">SectionLifecycle</a> can be made known outside of the hierarchy. This allows you to know when you should start fetching your data.</p><p>Since a service is tied to a particular Section, this means it has access to all the <code>@Prop</code> and <code>@State</code> and interacts with them. This also means that the service is able to respond to events such as <code>@OnViewportChanged</code> and <code>@OnRefresh</code>, and call for a state update when new data arrives to allow the data to flow down the hierarchy.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creation"></a>Creation<a class="hash-link" href="#creation" title="Direct link to heading">#</a></h3><p>Services are persisted across state updates and for however long the sections remain in the hierarchy. The first and only instance of a <code>Service</code> should be created in the lifecycle <code>@OnCreateService</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@GroupSectionSpec</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public ServiceSectionSpec {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateService</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  static DataLoader onCreateServices(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Prop Configuration config) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return DataLoaderFactory.createLoader(config);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="lifecycle-of-services"></a>Lifecycle of Services<a class="hash-link" href="#lifecycle-of-services" title="Direct link to heading">#</a></h3><p><code>@OnBindService</code> is a callback that allows you to define how your service should interact with its section. This bridge can be used to pass the new set of data to the section whenever a fetch is completed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnBindService</span></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onBindService(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataLoader service) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    service.registerEventLoader(ServiceSection.dataLoaded(c));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnEvent(YourData.class)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">static void dataLoaded(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @FromEvent Data data) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServiceSection.updateData(c, data);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>@OnUnbindService</code> provides the callback for you to clean up and undo anything you have done in <code>@OnBindService</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnUnbindService</span></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onUnbindService(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  DataLoader service) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    service.unregisterEventLoader();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Both functions are called every time the section tree is updated by events such as a state update. These function receive the service created by <code>@OnCreateService</code> as the second function parameter.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-of-services-in-context"></a>Use of Services in context<a class="hash-link" href="#use-of-services-in-context" title="Direct link to heading">#</a></h2><p>As aforementioned, services are able to respond to Litho and Sections events such as <code>@OnRefresh</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> @OnRefresh</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> static void onRefresh(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   DataLoader service) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     service.refreshData();</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>or <code>@OnViewportChanged</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> @OnViewportChanged</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> static void onViewportChanged(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   SectionContext c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   int firstVisibleIndex,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   int lastVisibleIndex,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   int totalCount,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   int firstFullyVisibleIndex,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   int lastFullyVisibleIndex,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   DataLoader service) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     service.makeTailFetch();</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/sections/services.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/sections/working-ranges"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Advanced: Prefetch and pagination</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/sections/view-support"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Advanced: Mixing with Android Views ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usage" class="table-of-contents__link">Usage</a><ul><li><a href="#creation" class="table-of-contents__link">Creation</a></li><li><a href="#lifecycle-of-services" class="table-of-contents__link">Lifecycle of Services</a></li></ul></li><li><a href="#use-of-services-in-context" class="table-of-contents__link">Use of Services in context</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c13abd95.js"></script>
<script src="/assets/js/main.f78999c6.js"></script>
</body>
</html>