<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Visibility Handling | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Visibility Handling | Litho"><meta data-react-helmet="true" name="description" content="Litho provides predefined APIs to support a range of use cases where components"><meta data-react-helmet="true" property="og:description" content="Litho provides predefined APIs to support a range of use cases where components"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/visibility-handling/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.500f1454.css">
<link rel="preload" href="/assets/js/runtime~main.ca57c78c.js" as="script">
<link rel="preload" href="/assets/js/main.04add213.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="color:#091E42" role="banner"><div class="announcementBarContent_3EUC">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Main Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/components-basics/">Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/props/">Types of Props</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Hooks and State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/flexbox-yoga/">Layout System with Flexbox</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Coordinating State and Actions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/hoisting-state/">Hoisting State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/communicating-between-components/">Communicating Between Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/componenttree/">ComponentTree</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/visibility-handling/">Visibility Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/keys-and-identity/">Keys and Component Identity</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Codegen APIs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tooling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Visibility Handling</h1></header><div class="markdown"><p>Litho provides predefined APIs to support a range of use cases where components
require callbacks when the on-screen position relative to the visible view port changes.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="types-of-visibility-callbacks">Types of Visibility Callbacks<a aria-hidden="true" class="hash-link" href="#types-of-visibility-callbacks" title="Direct link to heading">â€‹</a></h2><p>The framework currently supports six types of Visibility callbacks:</p><ul><li><a href="/javadoc/com/facebook/litho/VisibleEvent.html" target="_blank" rel="noopener noreferrer">Visible</a>: Invoked when at least one pixel of the Component is visible.</li><li><a href="/javadoc/com/facebook/litho/InvisibleEvent.html" target="_blank" rel="noopener noreferrer">Invisible</a>: Invoked when the Component no longer has any pixels on the screen.</li><li><a href="/javadoc/com/facebook/litho/FocusedVisibleEvent.html" target="_blank" rel="noopener noreferrer">Focused Visible</a>: Invoked when either the Component occupies at least half of the viewport, or, if the Component is smaller than half the viewport, when it is fully visible.</li><li><a href="/javadoc/com/facebook/litho/UnfocusedVisibleEvent.html" target="_blank" rel="noopener noreferrer">Unfocused Visible</a>: Invoked when the Component is no longer focused, i.e. it is not fully visible and does not occupy at least half the viewport.</li><li><a href="/javadoc/com/facebook/litho/FullImpressionVisibleEvent.html" target="_blank" rel="noopener noreferrer">Full Impression Visible Event</a>: If the Component is smaller than the viewport, this callback is invoked when the entire Component is visible in the viewport. If the Component is bigger than the viewport, then just covering the viewport won&#x27;t invoke this callback: it will be invoked when all the edges have passed through the viewport once.</li><li><a href="/javadoc/com/facebook/litho/VisibilityChangedEvent.html" target="_blank" rel="noopener noreferrer">Visibility Changed</a>: Invoked everytime the bounds of the Component changes.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="usage">Usage<a aria-hidden="true" class="hash-link" href="#usage" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="java-api">Java API:<a aria-hidden="true" class="hash-link" href="#java-api" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_31ik" id="delcaring-visibility-event-callbacks">Delcaring Visibility Event Callbacks:<a aria-hidden="true" class="hash-link" href="#delcaring-visibility-event-callbacks" title="Direct link to heading">â€‹</a></h4><p>Visibility callbacks are declared like all other events in Litho. Please see the documentation for <a href="/docs/codegen/events-for-specs/">events</a> to learn more.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="using-visibility-event-handlers">Using Visibility Event handlers:<a aria-hidden="true" class="hash-link" href="#using-visibility-event-handlers" title="Direct link to heading">â€‹</a></h4><p>Visibility handlers can be set on any component. Here is a comprehensive example of its usage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class VisibilityEventExampleSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .alignItems(YogaAlign.STRETCH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .text(&quot;This is a layout spec&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .visibleHandler(VisibilityEventExample.onTitleVisible(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .invisibleHandler(VisibilityEventExample.onTitleInvisible(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .focusedHandler(VisibilityEventExample.onComponentFocused(c, &quot;someStringParam&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .fullImpressionHandler(VisibilityEventExample.onComponentFullImpression(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .visibilityChangedHandler(VisibilityEventExample.onComponentVisibilityChanged(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(VisibleEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onTitleVisible(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(&quot;VisibilityEvent&quot;, &quot;The title entered the Visible Range&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(InvisibleEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onTitleInvisible(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(&quot;VisibilityEvent&quot;, &quot;The title is no longer visible&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(FocusedVisibleEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onComponentFocused(ComponentContext c, @Param String stringParam) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(&quot;VisibilityEvent&quot;, &quot;The component is focused with param: &quot; + stringParam);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(FullImpressionVisibleEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onComponentFullImpression(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(&quot;VisibilityEvent&quot;, &quot;The component has logged a full impression&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(VisibilityChangedEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onComponentVisibilityChanged(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent int visibleTop,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent int visibleLeft,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent int visibleHeight,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent int visibleWidth,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent float percentVisibleHeight,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @FromEvent float percentVisibleWidth) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Log.d(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;VisibilityEvent&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;The component&#x27;s visible size is &quot; + visibleHeight + &quot;h&quot; + visibleWidth + &quot;w&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>VisibilityChangedEvents should be used with particular care since they will be invoked on every frame while scrolling. No heavy work should be done inside the VisibilityChangedEvents callback. Visible, Invisible, Focused, Unfocused and Full Impression are recommended over VisibilityChanged whenever possible.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="custom-visibility-percentage">Custom visibility percentage<a aria-hidden="true" class="hash-link" href="#custom-visibility-percentage" title="Direct link to heading">â€‹</a></h3><p>By default, <code>VisibleEvent</code> is triggered when at least 1 pixel of the Component is visible. In some cases you may want to listen to custom visibility changes, and perform an action when the Component is only partially visible.
You can specify a ratio of the Component width or height for the visibility callback to be dispatched by using <code>visibleHeightRatio</code> and <code>visibleWidthRatio</code> props when specifying a visibility handler.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .alignItems(YogaAlign.STRETCH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .text(&quot;This is MY layout spec&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .visibleHandler(MyLayout.onTitleVisible(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .visibleHeightRatio(0.8f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .visibleWidthRatio(0.1f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For the example above, a VisibilityEvent is dispatched when at least 80% of the Component&#x27;s height and 10% of the Component&#x27;s width is visible.
When the Component&#x27;s visible percentage changes to less than 80% of total height, an invisible event will be dispatched.
If not specified, the default width or height ratio is 1f.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="changing-lithoview-visibility">Changing LithoView visibility<a aria-hidden="true" class="hash-link" href="#changing-lithoview-visibility" title="Direct link to heading">â€‹</a></h3><p>There are cases when you need to trigger visibility events on the LithoView components because the UI visibility changed, but the UI did not receive any callback to inform it of this change. An example is when a new activity is added to the back stack, covering the UI. In such cases you need to inform the <code>LithoView</code> that its visibility status changed, to tell the UI whether it is visible or not. You may want to do this when <code>Fragment#setUserVisibleHint</code> or <code>onResume/onPause</code> are called.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="litholifecycleprovider-api">LithoLifecycleProvider API<a aria-hidden="true" class="hash-link" href="#litholifecycleprovider-api" title="Direct link to heading">â€‹</a></h4><p>The <code>LithoLifecycleProvider</code> API can inform LithoViews which are registered to listen to lifecycle state changes that their visibility status changed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public interface LithoLifecycleProvider {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void moveToLifecycle(LithoLifecycle lithoLifecycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void addListener(LithoLifecycleListener listener);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following states are valid LithoLifecycleProvider states:</p><ul><li><code>HINT_INVISIBLE</code>: this state indicates that the lifecycle provider is considered to be not visible on screen. Lifecycle observers can perform operations which are associated with invisibility status. An example of moving to <code>HINT_INVISIBLE</code> state is when a fragment goes from <code>resumed</code> to <code>paused</code> because the app was backgrounded.</li><li><code>HINT_VISIBLE</code>: this state indicates that the lifecycle provider is considered visible on screen. Lifecycle observers can perform operations which are associated with visibility status. An example of moving to <code>HINT_VISIBLE</code> state is when a fragment goes from <code>paused</code> to <code>resumed</code> because the app was foregrounded.</li><li><code>DESTROYED</code>: this is the final state of a lifecycle provider. Lifecycle observers can perform operations associated with releasing resources. An example of moving to <code>DESTOYED</code> state is when the hosting Activity is destroyed.</li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="listening-to-a-litholifecycleprovider-state-changes">Listening to a <code>LithoLifecycleProvider</code> state changes<a aria-hidden="true" class="hash-link" href="#listening-to-a-litholifecycleprovider-state-changes" title="Direct link to heading">â€‹</a></h4><p>You can register a <code>LithoView</code> to listen to state changes of a <code>LithoLifecycleProvider</code> instance when you create it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">final LithoLifecycleProvider lifecycleProvider;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">final LithoView lithoView = LithoView.create(c, component, lithoLifecycleProvider);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>These actions will be performed when moving to the following <code>LithoLifecycleProvider</code> states:</p><ul><li><code>HINT_INVISIBLE</code>: <code>InvisibleEvents</code> will be dispatched to all Components inside the <code>LithoView</code> which were visible.</li><li><code>HINT_VISIBLE</code>: <code>VisibleEvents</code> will be dispatched to all Components inside the <code>LithoView</code> which meet the visibility criteria.</li><li><code>DESTROYED</code>: The <code>ComponentTree</code> associated with the <code>LithoView</code> will be released, <code>InvisibleEvents</code> will be dispatched to all Components which were visible and all content will be unmounted.</li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="aosplitholifecycleprovider"><code>AOSPLithoLifecycleProvider</code><a aria-hidden="true" class="hash-link" href="#aosplitholifecycleprovider" title="Direct link to heading">â€‹</a></h4><p>This is an implementation of <code>LithoLifecycleProvider</code> which has the state tied to that of an AOSP <a href="https://developer.android.com/topic/libraries/architecture/lifecycle#lco" target="_blank" rel="noopener noreferrer">LifecycleOwner</a>.</p><ul><li><code>LifecycleOwner</code> in <code>ON_PAUSE</code> state will move the <code>AOSPLithoLifecycleProvider</code> to <code>HINT_INVISIBLE</code> state</li><li><code>LifecycleOwner</code> in <code>ON_RESUME</code> state will move the <code>AOSPLithoLifecycleProvider</code> to <code>HINT_VISIBLE</code> state</li><li><code>LifecycleOwner</code> in <code>ON_DESTROY</code> state will move the <code>AOSPLithoLifecycleProvider</code> to <code>DESTROYED</code> state</li></ul><p>You can use <code>AOSPLithoLifecycleProvider</code> when you want to associate a LithoView&#x27;s visibility status with the lifecycle of a Fragment, Activity or custom LifecycleOwner, when <code>resumed</code> means the LithoView is on screen and <code>paused</code> means the LithoView is hidden.</p><p>Click <a href="https://github.com/facebook/litho/blob/master/sample/src/main/java/com/facebook/samples/litho/java/lifecycle/LifecycleDelegateActivity.java#L79" target="_blank" rel="noopener noreferrer">here</a> to see an example in the litho sample app.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">final AOSPLithoLifecycleProvider lifecycleProvider = new AOSPLithoLifecycleProvider(fragment);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="handling-custom-state-changes-litholifecycleproviderdelegate">Handling custom state changes: LithoLifecycleProviderDelegate<a aria-hidden="true" class="hash-link" href="#handling-custom-state-changes-litholifecycleproviderdelegate" title="Direct link to heading">â€‹</a></h4><p><code>AOSPLithoLifecycleProvider</code> covers the most common cases, but there are scenarios where a LifecycleOwner&#x27;s state doesn&#x27;t match what we see on screen.
Such examples are:</p><ul><li><p>Fragments in a ViewPager, where the previous and next visible Fragments are prepared and in a <code>resumed</code> state before they&#x27;re actually visible. Click <a href="https://github.com/facebook/litho/blob/master/sample/src/main/java/com/facebook/samples/litho/java/lifecycle/ScreenSlidePageFragment.java" target="_blank" rel="noopener noreferrer">here</a> to see an example in the litho sample app.</p></li><li><p>Adding a Fragment on top of another Fragment doesn&#x27;t move the first Fragment to a <code>paused</code> state, and there&#x27;s no indication that it&#x27;s no longer visible to the user. Click <a href="https://github.com/facebook/litho/blame/master/sample/src/main/java/com/facebook/samples/litho/java/lifecycle/LifecycleFragment.java" target="_blank" rel="noopener noreferrer">here</a> to see an example in the litho sample app.</p></li></ul><p>When you need to handle these state changes manually, you can use <code>LithoLifecycleProviderDelegate</code>, a generic <code>LithoLifecycleProvider</code> implementation, to change state when appropriate.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">final LithoLifecycleProviderDelegate lifecycleProvider = new LithoLifecycleProviderDelegate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lifecycleProvider.moveToLifecycle(&lt;new LithoLifecycle state&gt;);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="nested-componenttrees-and-litholifecycleprovider">Nested ComponentTrees and <code>LithoLifecycleProvider</code><a aria-hidden="true" class="hash-link" href="#nested-componenttrees-and-litholifecycleprovider" title="Direct link to heading">â€‹</a></h4><p>The Litho APIs for writing Lists (Sections, VerticalScrollSpec, HorizontalScrollSpec) will create hierarchies of nested ComponentTrees:</p><ul><li>a ComponentTree at the root of the hierarchy, encapsulating the entire list (associated with a root LithoView)</li><li>a ComponentTree for each item in the List (associated with a LithoView child of the root LithoView)</li></ul><p>If the root LithoView is subscribed to listen to a <code>LithoLifecycleProvider</code>, then all nested ComponentTrees/child LithoViews will listen to the outer <code>LithoLifecycleProvider</code> too and will receive the correct information about visibility/destroyed state.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The section below contains information about deprecated APIs. Please consider using <code>LithoLifecycleProvider</code> for manually informing a <code>LithoView</code> about visibility changes.</p></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="setvisibilityhint-deprecated">setVisibilityHint (Deprecated)<a aria-hidden="true" class="hash-link" href="#setvisibilityhint-deprecated" title="Direct link to heading">â€‹</a></h4><p>Example usage:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">LithoView.setVisibilityHint(true); // This will dispatch visible/focused events as necessary on all components inside this LithoView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LithoView.setVisibilityHint(false); // This will dispatch invisible/unfocused events as necessary on all components inside this LithoView</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After calling <code>LithoView.setVisibilityHint(false)</code>, the LithoView will consider itself not visible and will ignore any requests to mount until <code>setVisibilityHint(true)</code> is called.
You may still unmount the entire LithoView content by calling <code>unmountAll</code> if the visibility hint was set to false.
Resetting the visibility hint to true after it was set to false will also trigger a mount pass, in case the visible bounds changed while the LithoView was ignoring mount requests.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="troubleshooting">Troubleshooting<a aria-hidden="true" class="hash-link" href="#troubleshooting" title="Direct link to heading">â€‹</a></h3><p>If you are not seeing your visibility event fired when you expect it to be, you can take the following steps:</p><ol><li>Verify that incremental mount is enabled for your Component. It is enabled by default, but if you turned it off, then visibility events will not be fired.</li><li>Verify that you actually set the event that you defined in your spec on your Component (i.e. by calling <code>visibleHandler(MyLayout.onTitleVisible(c))</code> or similar.</li><li>Visibility handlers are fired in <a href="https://github.com/facebook/litho/blob/master/litho-core/src/main/java/com/facebook/litho/MountState.java#L489:L657" target="_blank" rel="noopener noreferrer"><code>MountState.processVisibilityOutputs()</code></a>. You can step through this method and see why the event that you expect to be fired is not being fired.</li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/mainconcepts/coordinate-state-actions/visibility-handling.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/mainconcepts/coordinate-state-actions/componenttree/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->ComponentTree</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/mainconcepts/coordinate-state-actions/keys-and-identity/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Keys and Component Identity<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types-of-visibility-callbacks" class="table-of-contents__link toc-highlight">Types of Visibility Callbacks</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#java-api" class="table-of-contents__link toc-highlight">Java API:</a></li><li><a href="#custom-visibility-percentage" class="table-of-contents__link toc-highlight">Custom visibility percentage</a></li><li><a href="#changing-lithoview-visibility" class="table-of-contents__link toc-highlight">Changing LithoView visibility</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ca57c78c.js"></script>
<script src="/assets/js/main.04add213.js"></script>
</body>
</html>