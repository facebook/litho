<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Litho Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Litho Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Mount Specs | Litho</title><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/mainconcepts/uicomposition/mount-specs"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Mount Specs | Litho"><meta data-react-helmet="true" name="description" content="This page was moved from the old website without any change and might be updated"><meta data-react-helmet="true" property="og:description" content="This page was moved from the old website without any change and might be updated"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/mainconcepts/uicomposition/mount-specs"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/uicomposition/mount-specs" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/uicomposition/mount-specs" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7ff81ca3.css">
<link rel="stylesheet" href="/assets/css/main.8f6b6ba9.css">
<link rel="preload" href="/assets/js/styles.10ad285b.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.5afbcf09.js" as="script">
<link rel="preload" href="/assets/js/main.70c11f54.js" as="script">
<link rel="preload" href="/assets/js/1.bef55bbe.js" as="script">
<link rel="preload" href="/assets/js/2.9164bb93.js" as="script">
<link rel="preload" href="/assets/js/101.76b4e9ac.js" as="script">
<link rel="preload" href="/assets/js/104.2357c688.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.c8b14f56.js" as="script">
<link rel="preload" href="/assets/js/17896441.41a43866.js" as="script">
<link rel="preload" href="/assets/js/93e5bf8e.2b321543.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Litho</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro/motivation">Docs</a></li><li class="menu__list-item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="menu__link">API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/overview">Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">What is Litho?</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/motivation">Motivation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intro/built-with-litho">Built with Litho</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/project-setup">Setting up the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/first-components">Components and Props</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/adding-state">Adding State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/handling-events">Handling Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/building-lists">Building Lists</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Main Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">UI Composition</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/uicomposition/layout-specs">Layout Specs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/mainconcepts/uicomposition/mount-specs">Mount Specs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/uicomposition/flexbox-yoga">Layout System with Flexbox</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Coordinating State and Actions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/state-overview">State Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/hoisting-state">Hoisting State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/events">Events Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/trigger-events">Triggering events with Handles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/treeprops">TreeProps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/componenttree">ComponentTree</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mainconcepts/coordinate-state-actions/dynamic-props">Dynamic Props</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Building lists</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/start">Basics: DiffSection and GroupSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/recycler-collection-component">Adding and adapting RecyclerCollection to your App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/best-practices">Best Practices and Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/hscrolls">Nested scrolling and measurement</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/api-overview">API üìÑ: annotations, events and lifecycles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/working-ranges">Advanced: Prefetch and pagination</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/services">Advanced: Granular Dependency Injection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/view-support">Advanced: Mixing with Android Views</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/diff-sections">Advanced: Writing your own DiffSection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sections/architecture">Internal üèó: Sections implementation architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Widgets</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/widgets/builtin-widgets">Built-in widgets</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devtools/android-studio-plugin">Android Studio Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/devtools/flipper-plugins">Flipper Plugins</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/testing-overview">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Unit Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/unit-testing">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/subcomponent-testing">Sub-Component Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/prop-matching">Matching @Prop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/testing-treeprops">Matching @TreeProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/injectprop-matching">Matching @InjectProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/event-handler-testing">Event Handler Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/sections-testing">Testing Sections</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">UI Tests</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/espresso-testing">End-to-End Tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/testing/tests-in-android-studio">Testing in Android Studio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Animations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-basics">Animation basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-types">Types of Transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-all-layout">Animating All Layout</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-choreography">Customizing Transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-definitions">Advanced: More ways to define transitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/animations/transition-key-types">Advanced: Transitions key scoping</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Accessibility</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/accessibility/accessibility-overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/analysing-performance">Analysing Performance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/spotting-performance-regressions">Spotting Performance Regressions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/immutability">Immutability</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/props-vs-state">Props vs. State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/best-practices/coding-style">Coding Style</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deep Dive</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Reconciliation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/reconciliation">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/reconciliation/enabling-reconciliation">Enabling Reconciliation</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/deep-dive/incremental-mount">Incremental Mount</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Mount Specs</h1></header><div class="markdown"><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Content will be updated</h5></div><div class="admonition-content"><p>This page was moved from the old website without any change and might be updated</p></div></div><p>A <em>mount spec</em> defines a component that can render views or drawables.</p><p>Mount specs should only be created when you need to integrate your own views/drawables with Litho. <em>Mount</em> here refers to the operation performed by all components in a layout tree to extract their rendered state (a <code>View</code> or a <code>Drawable</code>) to be displayed.</p><p>Mount spec classes should be annotated with <code>@MountSpec</code> and implement at least an <code>@OnCreateMountContent</code> method. The other methods listed below are optional.</p><p>The lifecycle of mount spec components is as follows:
[<code>BG</code> = occurs on BG thread when possible -- do not modify the view hierarchy, <code>UI</code> = can occur on UI thread, <code>PC</code> = Performance critical -- put as little work in it as possible, use <code>BG</code> methods instead]</p><ul><li>Run <code>@OnPrepare</code> once, before layout calculation. <code>BG</code>/<code>UI</code></li><li>Run <code>@OnMeasure</code> optionally during layout calculation. This will <strong>not</strong> be called if Yoga has already determined your component&#x27;s bounds (e.g. a static width/height was set on the component). <code>BG</code>/<code>UI</code></li><li>Run <code>@OnBoundsDefined</code> once, after layout calculation. This will be called whether or not <code>@OnMeasure</code> was called. <code>BG</code>/<code>UI</code></li><li>Run <code>@OnCreateMountContent</code> before the component is attached to a hosting view. This content may be reused for other instances of this component. <code>UI</code></li><li>Run <code>@OnMount</code> before the component is attached to a hosting view. This will happen when the component is about to become visible when incremental mount is enabled (it is enabled by default). <code>UI</code>/<code>PC</code></li><li>Run <code>@OnBind</code> after the component is attached to a hosting view. <code>UI</code>/<code>PC</code></li><li>Run <code>@OnUnbind</code> before the component is detached from a hosting view. <code>UI</code>/<code>PC</code></li><li>Run <code>@OnUnmount</code> optionally after the component is detached from a hosting view. See incremental mount notes on <code>@OnMount</code>: they apply in reverse here. <code>UI</code>/<code>PC</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mounting"></a>Mounting<a class="hash-link" href="#mounting" title="Direct link to heading">#</a></h2><p>Let&#x27;s start with a simple <code>ColorComponent</code> that takes a color name as a prop and mounts its respective <code>ColorDrawable</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@MountSpec</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class ColorComponentSpec {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @OnCreateMountContent</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static ColorDrawable onCreateMountContent(Context context) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return new ColorDrawable();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @OnMount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static void onMount(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      ComponentContext c,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      ColorDrawable colorDrawable,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      @Prop String colorName) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    colorDrawable.setColor(Color.parseColor(colorName));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li>The mount operation has an API very similar to Android&#x27;s <a href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.Adapter.html" target="_blank" rel="noopener noreferrer">RecyclerView Adapters</a>. It has a <code>onCreateMountContent</code> method to create and initialize the <code>View</code>/<code>Drawable</code> content if the recycling pool is empty, and an <code>onMount</code> method to update the recycled content with the current information.</li><li>The return type from <code>onCreateMountContent</code> should always match the type of the second argument of <code>onMount</code>. They are required to be a <code>View</code> or a <code>Drawable</code> subclass. This is validated by the annotation processor at build time.</li><li>Mounting always happens in the main thread as it might have to deal with Android Views (which are bound to the main thread).</li><li><code>onCreateMountContent</code> cannot take a <code>@Prop</code> or any other annotated parameter.</li><li>Given that the <code>@OnMount</code> method always runs in the UI thread, expensive operations should not be performed in it.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inter-stage-inputs-and-outputs"></a>Inter-stage inputs and outputs<a class="hash-link" href="#inter-stage-inputs-and-outputs" title="Direct link to heading">#</a></h2><p>You can move heavy operations off the UI thread by performing them in the <code>@OnPrepare</code> method, which runs only once before the layout calculation is performed and can be executed in a background thread.</p><p>Let&#x27;s say we want to perform the color name parsing off the UI thread in the <code>ColorComponent</code> above. In order to do this, we need a way to pass values generated in the <code>@OnPrepare</code> method to the <code>@OnMount</code> implementation. Litho provides <em>inter-stage inputs and outputs</em> to allow you to do exactly that.</p><p>Let&#x27;s have a look at <code>ColorComponent</code> with the described <code>@OnPrepare</code> method.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@MountSpec</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class ColorComponentSpec {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @OnPrepare</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static void onPrepare(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      ComponentContext c,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      @Prop String colorName,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      Output&lt;Integer&gt; color) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    color.set(Color.parseColor(colorName));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @OnCreateMountContent</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static ColorDrawable onCreateMountContent(Context context) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return new ColorDrawable();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @OnMount</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static void onMount(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      ComponentContext c,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      ColorDrawable colorDrawable,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      @FromPrepare int color) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    colorDrawable.setColor(color);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Using <code>Output&lt;?&gt;</code> in any of the <code>@MountSpec</code> methods automatically creates an input for the following stages. In this case, an <code>@OnPrepare</code> output creates an input for <code>@OnMount</code>.</p><p>The annotation processor will ensure inter-stage invariants are respected at build time e.g. you cannot use outputs from <code>@OnMeasure</code> in <code>@OnPrepare</code> as <code>@OnPrepare</code> always runs before <code>@OnMeasure</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="measurement"></a>Measurement<a class="hash-link" href="#measurement" title="Direct link to heading">#</a></h2><p>You should implement an <code>@OnMeasure</code> method whenever you want to define how your component should be measured during the layout calculation.</p><p>Now, let&#x27;s suppose we want our <code>ColorComponent</code> to have a default width and enforce a certain aspect ratio when its height is undefined.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@OnMeasure</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">static void onMeasure(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ComponentContext c,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    ComponentLayout layout,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    int widthSpec,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    int heightSpec,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Size size) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  // If width is undefined, set default size.</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  if (SizeSpec.getMode(widthSpec) == SizeSpec.UNSPECIFIED) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    size.width = 40;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  } else {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    size.width = SizeSpec.getSize(widthSpec);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  // If height is undefined, use 1.5 aspect ratio.</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  if (SizeSpec.getMode(heightSpec) == SizeSpec.UNSPECIFIED) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    size.height = size.width * 1.5;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  } else {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    size.height = SizeSpec.getSize(heightSpec);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can access component props with the <code>@Prop</code> annotation as usual in <code>@OnMeasure</code>. SizeSpec&#x27;s API is analogous to Android&#x27;s <a href="http://developer.android.com/reference/android/view/View.MeasureSpec.html" target="_blank" rel="noopener noreferrer">MeasureSpec</a>.</p><p>Just like <code>@OnPrepare</code>, the <code>@OnMeasure</code> method can also generate inter-stage outputs (accessible via the <code>@FromMeasure</code> argument annotation) and may be performed in a background thread.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="shouldupdate"></a>ShouldUpdate<a class="hash-link" href="#shouldupdate" title="Direct link to heading">#</a></h2><p>A MountSpec can define a method annotated with <code>@ShouldUpdate</code> to avoid remeasuring and remounting upon updates.
Invocations of <code>@ShouldUpdate</code> are dependent on whether a Component is a <strong>pure render function</strong>. A Component is a pure render function if the result of the rendering only depends on its props and states. This means that the Component shouldn&#x27;t be accessing any mutable global variable during <code>@OnMount</code>.
A <code>@MountSpec</code> can be defined as pure render by using the pureRender parameter of the <code>@MountSpec</code> annotation.
Only pure render Components can assume that when props do not change remounting won&#x27;t be needed. A <code>@ShouldUpdate</code> function can be defined as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@ShouldUpdate(onMount = true)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">static boolean shouldUpdate(@Prop Diff&lt;String&gt; someStringProp) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return !someStringProp.getPrevious().equals(someStringProp.getNext());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The parameters taken from <code>shouldUpdate</code> are <a href="/javadoc/com/facebook/litho/Diff.html" target="_blank" rel="noopener noreferrer">Diffs</a> of Props or State. A Diff is an object containing the value of a <code>@Prop</code> or a <code>@State</code> in the old components hierarchy and the value of the same <code>@Prop</code> or <code>@State</code> in the new components hierarchy.
In this example this component was defining <strong>someStringProp</strong> as a String <code>@Prop</code>. <code>shouldUpdate</code> will receive a <code>Diff&lt;String&gt;</code> to be able to compare the old and new value of this <code>@Prop</code>.
<code>shouldUpdate</code> has to take into consideration any prop and any states that are used at <code>@OnMount</code> time. It can safely ignore props and states that are only used at <code>@OnBind</code>/<code>@OnUnbind</code> time as these two methods will be executed regardless.</p><p>The <code>onMount</code> attribute on the <code>@ShouldUpdate</code> annotation controls whether this <code>shouldUpdate</code> check can happen at mount time. By default, Litho will try to do this reconciliation at layout time, but if layout diffing is turned off it might be useful to set onMount to true in order to execute this check at mount time instead. The <code>onMount</code> attribute is set to false by default as the equality check might be heavy itself and make mount performances worse.</p><p><code>@ShouldUpdate</code> annotated methods are currently only supported in <code>@MountSpec</code>. We have plans to expand the support to complex layouts in the future but at the moment a <code>@ShouldUpdate</code> annotated method in a <code>@LayoutSpec</code> would have no effect.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pre-allocation"></a>Pre-allocation<a class="hash-link" href="#pre-allocation" title="Direct link to heading">#</a></h2><p>When a MountSpec component is being mounted, its <code>View</code>/<code>Drawable</code> content needs to be either initialized or reused from the recycling pool. If the pool is empty, a new instance will be created at that time, which might keep the UI thread too busy and drop one or more frames. To mitigate that, Litho can pre-allocate a few instances and put in the recycling pool.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><div tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@MountSpec(poolSize = 3, canPreallocate = true)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class ColorComponentSpec {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  ...</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>canPreallocate</code> enables pre-allocation for this MountSpec and <code>poolSize</code> defines the amount of instances to pre-allocate. For this <code>ColorComponent</code> example, three instances of <code>ColorDrawable</code> will be created and put in the recycling pool. This option is recommended for MountSpec components that inflate a complex <code>View</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/mainconcepts/uicomposition/mount-specs.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/mainconcepts/uicomposition/layout-specs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Layout Specs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/mainconcepts/uicomposition/flexbox-yoga"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Layout System with Flexbox ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mounting" class="table-of-contents__link">Mounting</a></li><li><a href="#inter-stage-inputs-and-outputs" class="table-of-contents__link">Inter-stage inputs and outputs</a></li><li><a href="#measurement" class="table-of-contents__link">Measurement</a></li><li><a href="#shouldupdate" class="table-of-contents__link">ShouldUpdate</a></li><li><a href="#pre-allocation" class="table-of-contents__link">Pre-allocation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Source Projects</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/styles.10ad285b.js"></script>
<script src="/assets/js/runtime~main.5afbcf09.js"></script>
<script src="/assets/js/main.70c11f54.js"></script>
<script src="/assets/js/1.bef55bbe.js"></script>
<script src="/assets/js/2.9164bb93.js"></script>
<script src="/assets/js/101.76b4e9ac.js"></script>
<script src="/assets/js/104.2357c688.js"></script>
<script src="/assets/js/935f2afb.c8b14f56.js"></script>
<script src="/assets/js/17896441.41a43866.js"></script>
<script src="/assets/js/93e5bf8e.2b321543.js"></script>
</body>
</html>