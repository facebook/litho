<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">Sub-Component Testing | Litho</title><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/testing/subcomponent-testing"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Sub-Component Testing | Litho"><meta data-react-helmet="true" name="description" content="Checkout the getting started section to setup the test environment correctly."><meta data-react-helmet="true" property="og:description" content="Checkout the getting started section to setup the test environment correctly."><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/testing/subcomponent-testing"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/testing/subcomponent-testing" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/testing/subcomponent-testing" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7fecd722.css">
<link rel="preload" href="/assets/js/runtime~main.c13abd95.js" as="script">
<link rel="preload" href="/assets/js/main.f78999c6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Tools</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Testing</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/testing-overview">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Unit Tests</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/unit-testing">Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/testing/subcomponent-testing">Sub-Component Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/prop-matching">Matching @Prop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/testing-treeprops">Matching @TreeProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/injectprop-matching">Matching @InjectProp</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/event-handler-testing">Event Handler Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/sections-testing">Testing Sections</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">UI Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/tests-in-android-studio">Testing in Android Studio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deep Dive</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributing Documentation</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">Sub-Component Testing</h1></header><div class="markdown"><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Checkout the <a href="/docs/testing/unit-testing">getting started</a> section to setup the test environment correctly.</p></div></div><p>This document outlines APIs for testing assertions about the component hierarchy.
Litho&#x27;s testing APIs are similar to the APIs of
<a href="https://joel-costigliola.github.io/assertj/" target="_blank" rel="noopener noreferrer">AssertJ</a> and
<a href="http://hamcrest.org/JavaHamcrest/" target="_blank" rel="noopener noreferrer">Hamcrest</a>. If you have used the two before,
this should feel very familiar. This guide will describe the APIs and its usage.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basic-sub-component-matching"></a>Basic Sub-Component Matching<a class="hash-link" href="#basic-sub-component-matching" title="Direct link to heading">#</a></h2><p>To demonstrate the usage of these APIs consider the following component that truncates the text
passed and appends ellipsis.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span></span><span class="token-line" style="color:#393A34"><span class="token plain">class TruncatingComponentSpec {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(ComponentContext c, @Prop String text) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // A unicode-aware implementation is left as an exercise to the reader.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String s = text.length() &gt; 16 ? text.substring(0, 16) + &quot;...&quot; : text;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Text.create(c).text(s).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>As a quick side note; for trivial components like these it is often more appropriate
to exploit the fact that these are pure functions that can be statically invoked.
Whenever possible, test your business logic in isolation.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setup"></a>Setup<a class="hash-link" href="#setup" title="Direct link to heading">#</a></h3><ul><li>Add <code>@RunWith(LithoTestRunner.class)</code> to the top of the test class.</li><li>Add a JUnit <a href="https://github.com/junit-team/junit4/wiki/Rules" target="_blank" rel="noopener noreferrer"><code>@Rule</code></a> <code>LithoViewRule</code>.</li><li>Add a check to ensure that tests are run in debug mode.
<code>ComponentsConfiguration.IS_INTERNAL_BUILD</code> must be true.</li></ul><p>The test class should look like the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Tests {@link LikersComponent}</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(RobolectricTestRunner.class)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TruncatingComponentTest {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public final @Rule LithoViewRule mLithoViewRule = new LithoViewRule();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Before</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void assumeInDebugMode() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    assumeThat(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;These tests can only be run in debug mode.&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentsConfiguration.IS_INTERNAL_BUILD, is(true)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing-assertion-on-the-component-hierarchy"></a>Testing assertion on the component hierarchy<a class="hash-link" href="#testing-assertion-on-the-component-hierarchy" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public void whenTextLengthIsLessThan16_shouldContainTextComponentWithFullText() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final ComponentContext c = mLithoViewRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final TruncatingComponent component = TruncatingComponent.create(c)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .text(&quot;Mr. Meeseeks&quot;).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  LithoAssertions.assertThat(c, component)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .has(subComponentWith(c, textEquals(&quot;Mr. Meeseeks&quot;)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="understanding-the-api-usage"></a>Understanding the API usage<a class="hash-link" href="#understanding-the-api-usage" title="Direct link to heading">#</a></h4><ul><li><code>LithoAssertions.assertThat(ComponentContext, Component)</code> will create and mount the layout.</li><li><code>has(ComponentContext, Condition)</code> tests if the component hierarchy passes the assertion of the
Condition. This is a standard AssertJ API; checkout all the
<a href="http://joel-costigliola.github.io/assertj/assertj-core-conditions.html" target="_blank" rel="noopener noreferrer">default APIs here</a>.</li><li><code>subComponentWith(ComponentContext, Condition)</code> is a utility method from Litho&#x27;s testing APIs
to compose Conditions together.</li><li><code>textEquals(String)</code> is another utility method which creates a Condition that passes only for a
Component of type <code>Text</code> which has its text property set to the String argument.</li><li><code>subComponentWith(c, textEquals(&quot;Mr. Meeseeks&quot;)</code> create a Condition which is exactly what it reads
like; &#x27;passes for a component of type Text with its text property set to &quot;Mr. Meeseeks&quot;&#x27;.</li></ul><p><strong>The following is a more complex composition of similar assertions</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">LithoAssertions.assertThat(c, component)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .has(allOf(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        subComponentWith(c, textEquals(&quot;Mr. Meeseeks&quot;)),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        subComponentWith(c, text(startsWith(&quot;Mr.&quot;))),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        subComponentWith(c, anyOf(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            text(endsWith(&quot;Sanchez&quot;)),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            text(containsString(&quot;Mees&quot;)))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The above assertions are just for illustrative purposes. This is not a good test!</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="matching-against-complex-hierarchies"></a>Matching against complex hierarchies<a class="hash-link" href="#matching-against-complex-hierarchies" title="Direct link to heading">#</a></h2><p>Consider a more complex LayoutSpec; it still has the same text truncation logic,
but with some new UI elements; wrapping the Text in a Column and a Card.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TruncatingComponentSpec {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public static Component onCreateLayout(ComponentContext c, @Prop String text) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String s = text.length() &gt; 16 ? text.substring(0, 16) + &quot;...&quot; : text;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .backgroundColor(Color.GRAY)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Card.create(c).content(Text.create(c).text(s)))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>The original test will start failing now.</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public void whenTextLengthIsLessThan16_shouldContainTextComponentWithFullText() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final ComponentContext c = mLithoViewRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final TruncatingComponent component = TruncatingComponent.create(c).text(&quot;Mr. Meeseeks&quot;).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  LithoAssertions.assertThat(c, component)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .has(subComponentWith(c, textEquals(&quot;Mr. Meeseeks&quot;)));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The error messages should provide sufficient information to understand why the test failed. The
error message prints out the component hierarchy, and the assertion that failed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly log"><pre tabindex="0" class="prism-code language-log codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Expecting:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;TruncatingComponent{0, 0 - 100, 100}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Card{0, 0 - 100, 6}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Column{3, 2 - 97, 2}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Text{0, 0 - 94, 0 text=&quot;Szechuan Sauce&quot;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      CardClip{0, 0 - 94, 0}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    CardShadow{0, 0 - 100, 6}&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">to have:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;sub component with &lt;text &lt;is &quot;Szechuan Sauce&quot;&gt;&gt;&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here the <code>Text</code> component was expected to be a direct descendant of <code>TruncatingComponent</code>, but the
error message shows that the Text component is several levels below the TruncatingComponent.</p><p>This test can be fixed by using a different Condition API called <code>deepSubComponentWith</code>. As the name
suggests this condition will test against all the components in the hierarchy, and not just the immediate
descendant.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public void whenTextLengthIsLessThan16_shouldContainTextComponentWithFullText() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final ComponentContext c = mLithoViewRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final TruncatingComponent component = TruncatingComponent.create(c).text(&quot;Mr. Meeseeks&quot;).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  LithoAssertions.assertThat(c, component)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    .has(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      deepSubComponentWith(c, textEquals(&quot;Mr. Meeseeks&quot;))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Find all the Component conditions in the <a href="/javadoc/com/facebook/litho/testing/assertj/ComponentConditions.html" target="_blank" rel="noopener noreferrer">JavaDoc here</a></p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="custom-conditions"></a>Custom Conditions<a class="hash-link" href="#custom-conditions" title="Direct link to heading">#</a></h2><p>Custom Conditions can be created by implementing the <code>Condition&lt;InspectableComponent&gt;</code> interface
which consists of a single method: <code>matches(InspectableComponent)</code>.
<a href="/javadoc/com/facebook/litho/testing/subcomponents/InspectableComponent.html" target="_blank" rel="noopener noreferrer">InspectableComponent</a>
is a wrapper around a <code>Component</code> with additional information about the component.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-custom-condition"></a>Creating a custom condition<a class="hash-link" href="#creating-a-custom-condition" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public static Condition&lt;InspectableComponent&gt; hasBackground() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return new Condition&lt;InspectableComponent&gt;() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean matches(InspectableComponent value) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      as(&quot;any background&quot;); // error message.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return value.getBackground() != null; // value contains the component being tested.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-a-custom-condition"></a>Using a custom condition<a class="hash-link" href="#using-a-custom-condition" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public void whenTruncatingComponentIsRendered_shouldHaveBackground() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final ComponentContext c = mLithoViewRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final TruncatingComponent component = TruncatingComponent.create(c).text(&quot;Mr. Meeseeks&quot;).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  LithoAssertions.assertThat(c, component)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .has(deepSubComponentWith(c, hasBackground()));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="simple-sub-component-matching"></a>Simple Sub-Component Matching<a class="hash-link" href="#simple-sub-component-matching" title="Direct link to heading">#</a></h2><p>To test for the mere presence of a component of a certain type use the
<a href="/javadoc/com/facebook/litho/testing/subcomponents/SubComponent.html" target="_blank" rel="noopener noreferrer">SubComponent.of</a> API.</p><p>Consider a hypothetical LayoutSpec called <code>StoryComponentSpec</code>, which composes a
<code>HeaderComponentSpec</code>, a <code>MessageComponentSpec</code>, a <code>LikersComponentSpec</code>, and a
<code>FeedbackComponentSpec</code>. The following test can be used to assert the presence of
these components in the hierarchy.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">public class StoryComponentTest {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  @Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  public void whenStoryComponentIsRendered_shouldContainAllSubcomponents() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final ComponentContext c = mLithoViewRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    final StoryComponent.Builder builder = StoryComponent.create(c).build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    assertThat(builder).hasSubComponents(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubComponent.of(HeaderComponent.class),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubComponent.of(MessageComponent.class),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubComponent.of(LikersComponent.class),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubComponent.of(FeedbackComponent.class));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    assertThat(builder)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .doesNotContainSubComponent(SubComponent.of(TruncatingComponent.class));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="using-with-legacy-apis"></a>Using with legacy APIs<a class="hash-link" href="#using-with-legacy-apis" title="Direct link to heading">#</a></h3><p>Litho provides a bridge interface <a href="/javadoc/com/facebook/litho/testing/subcomponents/SubComponent.html#legacySubComponent-com.facebook.litho.testing.subcomponents.SubComponent-" target="_blank" rel="noopener noreferrer">legacySubComponent</a>
which enables using the <code>SubComponent.of</code> API with the <code>subComponentWith</code> APIs. It accepts a
<code>SubComponent</code> and works with both shallow and deep sub-component traversals. This is great
if you want to ensure that a component with a given set of props exists in the component tree.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span></span><span class="token-line" style="color:#393A34"><span class="token plain">public void testSubComponentLegacyBridge() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  final ComponentContext c = mComponentsRule.getContext();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  assertThat(c, mComponent)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      .has(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          subComponentWith(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              c,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              legacySubComponent(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  SubComponent.of(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                      FooterComponent.create(c).subtitle(&quot;Gubba nub nub doo rah kah&quot;).build()))));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="resources"></a>Resources<a class="hash-link" href="#resources" title="Direct link to heading">#</a></h2><p>To learn more, check out these resources:</p><ul><li><a href="/javadoc/com/facebook/litho/testing/assertj/LithoViewSubComponentExtractor.html" target="_blank" rel="noopener noreferrer">LithoViewSubComponentExtractor</a></li><li><a href="/javadoc/com/facebook/litho/testing/assertj/LithoViewSubComponentDeepExtractor.html" target="_blank" rel="noopener noreferrer">LithoViewSubComponentDeepExtractor</a></li><li><a href="/javadoc/com/facebook/litho/testing/assertj/ComponentConditions.html" target="_blank" rel="noopener noreferrer">ComponentConditions</a></li><li><a href="http://joel-costigliola.github.io/assertj/assertj-core-conditions.html" target="_blank" rel="noopener noreferrer">AssertJ Conditions</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/testing/subcomponent-testing.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/testing/unit-testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Getting Started</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/testing/prop-matching"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Matching @Prop »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-sub-component-matching" class="table-of-contents__link">Basic Sub-Component Matching</a><ul><li><a href="#setup" class="table-of-contents__link">Setup</a></li><li><a href="#testing-assertion-on-the-component-hierarchy" class="table-of-contents__link">Testing assertion on the component hierarchy</a></li></ul></li><li><a href="#matching-against-complex-hierarchies" class="table-of-contents__link">Matching against complex hierarchies</a></li><li><a href="#custom-conditions" class="table-of-contents__link">Custom Conditions</a><ul><li><a href="#creating-a-custom-condition" class="table-of-contents__link">Creating a custom condition</a></li><li><a href="#using-a-custom-condition" class="table-of-contents__link">Using a custom condition</a></li></ul></li><li><a href="#simple-sub-component-matching" class="table-of-contents__link">Simple Sub-Component Matching</a><ul><li><a href="#using-with-legacy-apis" class="table-of-contents__link">Using with legacy APIs</a></li></ul></li><li><a href="#resources" class="table-of-contents__link">Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2021 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c13abd95.js"></script>
<script src="/assets/js/main.f78999c6.js"></script>
</body>
</html>