<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-architecture-overview">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Architecture Overview | Litho</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fblitho.com/docs/architecture-overview/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture Overview | Litho"><meta data-rh="true" name="description" content="Core Concepts"><meta data-rh="true" property="og:description" content="Core Concepts"><link data-rh="true" rel="icon" href="/images/favicon.png"><link data-rh="true" rel="canonical" href="https://fblitho.com/docs/architecture-overview/"><link data-rh="true" rel="alternate" href="https://fblitho.com/docs/architecture-overview/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fblitho.com/docs/architecture-overview/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5QBCYR8NMZ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.07476492.css">
<link rel="preload" href="/assets/js/runtime~main.268d42d2.js" as="script">
<link rel="preload" href="/assets/js/main.19e81f9b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine">Help Provide Humanitarian Aid to Ukraine</a></div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/mainconcepts/components-basics/">Docs</a><a href="https://fblitho.com/reference" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference [Ê™á´‡á´›á´€]</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Architecture Overview</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-concepts">Core Concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core Concepts" title="Direct link to Core Concepts">â€‹</a></h2><ul><li><strong>Component</strong>. A bundle of immutable data (Props) and pure functions that can transform the props into UI.</li><li><strong>LithoView</strong>. A subclass of <code>android.view.ViewGroup</code> that is used to render a <code>Component</code>.</li><li><strong>ComponentTree</strong>. A class that holds a single root <code>Component</code> and controls its lifecycle.</li><li><strong>LayoutState</strong>. Responsible for calculating a layout and holding onto the output of the calculation.</li><li><strong>MountState</strong>. Responsible for mounting the <code>Component</code> into a <code>LithoView</code>. Each <code>LithoView</code> has exactly one <code>MountState</code>.</li><li><strong>InternalNode</strong>. Class which represents a single node in the layout of a <code>Component</code>.</li><li><strong>LayoutOutput</strong>. Lightweight representation of the output of the layout pass. The <code>LayoutState</code> produces a List of <code>LayoutOutput</code>s that are then mounted by the <code>MountState</code>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="litho-lesson-component-to-screen">Litho Lesson: Component to Screen<a href="#litho-lesson-component-to-screen" class="hash-link" aria-label="Direct link to Litho Lesson: Component to Screen" title="Direct link to Litho Lesson: Component to Screen">â€‹</a></h2><p>We recommend you start by watching this video: it covers most of the core concepts above, as well as the fundamentals of how a Litho component gets turned into a <code>View</code> on screen.</p><iframe padding-top="10px" width="560" height="315" src="https://www.youtube-nocookie.com/embed/t9wTHnCx5RM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe><h2 class="anchor anchorWithStickyNavbar_LWe7" id="layout">Layout<a href="#layout" class="hash-link" aria-label="Direct link to Layout" title="Direct link to Layout">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initializing-layout">Initializing Layout<a href="#initializing-layout" class="hash-link" aria-label="Direct link to Initializing Layout" title="Direct link to Initializing Layout">â€‹</a></h3><p>Layout calculation is controlled by the <code>ComponentTree</code>. There are two mains ways that a <code>ComponentTree</code> will kick off a layout calculation:</p><ol><li>If the bounds are known in advance, then the user can call <code>setSizeSpec</code>/<code>setSizeSpecAsync</code> directly.</li><li>When the <code>ComponentTree</code> is set on a <code>LithoView</code>, then <code>LithoView#onMeasure()</code> will cause a layout to be calculated, unless the <code>ComponentTree</code> already has a valid layout (e.g. from an earlier <code>setSizeSpecAsync</code> call).</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="calculating-layout">Calculating Layout<a href="#calculating-layout" class="hash-link" aria-label="Direct link to Calculating Layout" title="Direct link to Calculating Layout">â€‹</a></h3><ol><li><code>LayoutState#createTree</code>. The first step in calculating layout is creating the tree of components (a tree of <code>InternalNode</code>s). This is done by recursively resolving each Component in the hierarchy, which for <code>Row</code> and <code>Column</code> means creating a new <code>InternalNode</code> and adding each of their children, and for all other Components just means calling <code>onCreateLayout</code>.</li><li><code>LayoutState#measureTree</code>. The second step in the calculation is measuring the tree. To do this the <code>InternalNode</code>s just defer to their underlying Yoga nodes, and Yoga does the calculation for us.</li><li><code>LayoutState#collectResults</code>. Now that we have created and measured the tree, we collect the results into a lightweight representation of elements that need mounting and throw away the <code>InternalNode</code> tree.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="layout-diffing">Layout Diffing<a href="#layout-diffing" class="hash-link" aria-label="Direct link to Layout Diffing" title="Direct link to Layout Diffing">â€‹</a></h3><p>When calculating new layout on a <code>ComponentTree</code> that already has an existing layout, it is common that much of the layout is actually quite similar to before (e.g. you might change the color of an icon when you click on it, but leave the remaining UI the same). In order to take advantage of the similarities in cases such as this, we do something called <code>layoutDiffing</code>. Each <code>LayoutState</code> that we create has a tree of <code>DiffNode</code>s that store the results of the layout that we calculated, including measurements. When creating a new <code>LayoutState</code> for a <code>ComponentTree</code> that already has one, we use the <code>DiffNode</code> tree to skip work where possible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mount">Mount<a href="#mount" class="hash-link" aria-label="Direct link to Mount" title="Direct link to Mount">â€‹</a></h2><p>Mount (<code>MountState#mount</code>) takes place for the first time when the <code>LithoView</code> is first laid out, and again every time the visible portion of the <code>LithoView</code> changes (provided that incremental mount is enabled). The mount step receives a <code>Rect</code> indicating the current visible area of the LithoView, and it uses that <code>Rect</code> to determine which of the <code>LayoutOutput</code>s from the Layout phase need to be either mounted (if they are now on the screen and they weren&#x27;t before) or unmounted (if they are no longer on the screen).</p><p>For each Component that needs to be mounted, we first acquire the <code>View</code>/<code>Drawable</code> defined in the <code>MountSpec</code>&#x27;s <code>onCreateMountContent</code> method. If possible, we acquire the mount content from our recycling pool (which is stored on a per-context basis), but if the pool is empty, then we create a new one. After that, we call <code>mount</code>, and then <code>bind</code>. When unmounting, we call <code>unbind</code> and then <code>unmount</code>.</p><p>Each time mount is called, we also call <code>MountState#processVisibilityOutputs</code>, which determines whether any visibility events need to be fired, and fires them if so.</p><p>Mounting (including firing visibility events) is bound to the UI thread, so operations called here should be as lightweight as possible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mount-diffing">Mount Diffing<a href="#mount-diffing" class="hash-link" aria-label="Direct link to Mount Diffing" title="Direct link to Mount Diffing">â€‹</a></h3><p>Mount diffing is a technique that Litho uses to avoid unmounting and mounting content when it is not necessary. Before mounting, we look at the currently mounted content and compare it with the content that we want to mount. If the currently mounted content does not need updating, then we don&#x27;t call <code>unmount</code>/<code>mount</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/architecture-overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core Concepts</a></li><li><a href="#litho-lesson-component-to-screen" class="table-of-contents__link toc-highlight">Litho Lesson: Component to Screen</a></li><li><a href="#layout" class="table-of-contents__link toc-highlight">Layout</a><ul><li><a href="#initializing-layout" class="table-of-contents__link toc-highlight">Initializing Layout</a></li><li><a href="#calculating-layout" class="table-of-contents__link toc-highlight">Calculating Layout</a></li><li><a href="#layout-diffing" class="table-of-contents__link toc-highlight">Layout Diffing</a></li></ul></li><li><a href="#mount" class="table-of-contents__link toc-highlight">Mount</a><ul><li><a href="#mount-diffing" class="table-of-contents__link toc-highlight">Mount Diffing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="https://fblitho.com/reference" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Reference [Ê™á´‡á´›á´€]</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2023 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.268d42d2.js"></script>
<script src="/assets/js/main.19e81f9b.js"></script>
</body>
</html>