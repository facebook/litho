"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3826],{3905:(e,n,t)=>{t.r(n),t.d(n,{MDXContext:()=>d,MDXProvider:()=>m,mdx:()=>u,useMDXComponents:()=>c,withMDXComponents:()=>p});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var d=a.createContext({}),p=function(e){return function(n){var t=c(n.components);return a.createElement(e,r({},n,{components:t}))}},c=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(d.Provider,{value:n},e.children)},g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(t),m=i,h=p["".concat(o,".").concat(m)]||p[m]||g[m]||r;return t?a.createElement(h,s(s({ref:n},d),{},{components:t})):a.createElement(h,s({ref:n},d))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=t[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},34936:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>o,contentTitle:()=>s,metadata:()=>l,toc:()=>d,default:()=>c});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),o={id:"working-ranges",title:"Advanced: Prefetch and pagination"},s=void 0,l={unversionedId:"sections/working-ranges",id:"sections/working-ranges",isDocsHomePage:!1,title:"Advanced: Prefetch and pagination",description:"The Working Ranges API provides the means to perform certain complex operations such as data prefetching or cache warming. It extends Sections with a set of appearance and visibility events when a Section enters and exits a given range of positions inside and outside the screen viewport. For example, you can perform a network request to start prefetching data as the last element of a list approaches the viewport.",source:"@site/../docs/sections/working-ranges.md",sourceDirName:"sections",slug:"/sections/working-ranges",permalink:"/docs/sections/working-ranges",editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/sections/working-ranges.md",version:"current",frontMatter:{id:"working-ranges",title:"Advanced: Prefetch and pagination"},sidebar:"mainSidebar",previous:{title:"API \ud83d\udcc4: annotations, events and lifecycles",permalink:"/docs/sections/api-overview"},next:{title:"Advanced: Granular Dependency Injection",permalink:"/docs/sections/services"}},d=[{value:"Defining a range",id:"defining-a-range",children:[]},{value:"Receiving Range events",id:"receiving-range-events",children:[]}],p={toc:d};function c(e){var n=e.components,t=(0,i.Z)(e,["components"]);return(0,r.mdx)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,"The Working Ranges API provides the means to perform certain complex operations such as data prefetching or cache warming. It extends Sections with a set of appearance and visibility events when a Section enters and exits a given range of positions inside and outside the screen viewport. For example, you can perform a network request to start prefetching data as the last element of a list approaches the viewport."),(0,r.mdx)("p",null,"The API is split in two parts: one defines what a range is, and the other are the Events triggered when Sections interact with the defined ranges."),(0,r.mdx)("h2",{id:"defining-a-range"},"Defining a range"),(0,r.mdx)("p",null,"To use the working range API, you first need to define your own working range class that implements the ",(0,r.mdx)("a",{parentName:"p",href:"pathname:///javadoc/com/facebook/litho/WorkingRange.html"},(0,r.mdx)("inlineCode",{parentName:"a"},"WorkingRange"))," interface. This interface provides two main functions: ",(0,r.mdx)("inlineCode",{parentName:"p"},"shouldEnterRange")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"shouldExitRange"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},"public class AtLeastPartiallyVisibleRange implements WorkingRange { ... }\n")),(0,r.mdx)("p",null,"For both functions the parameter ",(0,r.mdx)("inlineCode",{parentName:"p"},"position")," is the position of the item in the list, and the ",(0,r.mdx)("inlineCode",{parentName:"p"},"firstVisibleIndex")," / ",(0,r.mdx)("inlineCode",{parentName:"p"},"lastVisibleIndex")," / ",(0,r.mdx)("inlineCode",{parentName:"p"},"firstFullyVisibleIndex")," / ",(0,r.mdx)("inlineCode",{parentName:"p"},"lastFullyVisibleIndex")," parameters are current visible range of the viewport."),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"shouldEnterRange")," is used to check if the ",(0,r.mdx)("strong",{parentName:"p"},"item is within a user-defined range"),". In this example we check that means that the position is at least partially visible on screen."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},"@Override\npublic boolean shouldEnterRange(\n    int position,\n    int firstVisibleIndex,\n    int lastVisibleIndex,\n    int firstFullyVisibleIndex,\n    int lastFullyVisibleIndex) {\n  return position >= firstVisibleIndex\n    && position <= lastVisibleIndex;\n}\n")),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"shouldExitRange")," is used to check if the ",(0,r.mdx)("strong",{parentName:"p"},"item is outside a user-defined the range"),". In this example we check that means that the position completely not visible, not even partially."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},"@Override\npublic boolean shouldExitRange(\n    int position,\n    int firstVisibleIndex,\n    int lastVisibleIndex,\n    int firstFullyVisibleIndex,\n    int lastFullyVisibleIndex) {\n  return position < firstVisibleIndex\n    || position > lastVisibleIndex;\n}\n")),(0,r.mdx)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,r.mdx)("h5",{parentName:"div"},(0,r.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.mdx)("div",{parentName:"div",className:"admonition-content"},(0,r.mdx)("p",{parentName:"div"},"Compared to the working ranges in ",(0,r.mdx)("a",{parentName:"p",href:"https://componentkit.org/"},"ComponentKit"),", the granularity in ComponentKit is pixels whereas in Litho the granularity is positions. This means we can only tell the component if it's in the range instead of how many pixels are in the range."))),(0,r.mdx)("h2",{id:"receiving-range-events"},"Receiving Range events"),(0,r.mdx)("p",null,"After defining a working range, now we implement the callback functions inside the components that should receive the exit and enter range events on the ",(0,r.mdx)("inlineCode",{parentName:"p"},"@LayoutSpec")," that contains our ",(0,r.mdx)("inlineCode",{parentName:"p"},"RecyclerComponent"),"."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},"@LayoutSpec\nclass ListContainerComponentSpec {\n\n  @OnRegisterRanges\n  static void registerWorkingRanges(\n      ComponentContext c,\n      @Prop AtLeastPartiallyVisibleRange myRange) {\n    ListContainerComponent.registerPrefetchWorkingRange(c, myRange);\n  }\n}\n")),(0,r.mdx)("p",null,"The ",(0,r.mdx)("inlineCode",{parentName:"p"},"@OnEnteredRange")," event is triggered ",(0,r.mdx)("strong",{parentName:"p"},"when the component enters the range"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},'@OnEnteredRange(name = "prefetch")\nstatic void onEnteredWorkingRange(\n    ComponentContext c,\n    @Prop MyService service) {\n  service.startPrefetch();\n}\n')),(0,r.mdx)("p",null,"And the ",(0,r.mdx)("inlineCode",{parentName:"p"},"@OnExitedRange")," event is triggered ",(0,r.mdx)("strong",{parentName:"p"},"when the component exits the range"),":"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-java"},'@OnExitedRange(name = "prefetch")\nstatic void onExitedWorkingRange(\n    ComponentContext c,\n    @Prop MyService service) {\n  service.cancelAllPrefetches();\n}\n')),(0,r.mdx)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,r.mdx)("h5",{parentName:"div"},(0,r.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.mdx)("div",{parentName:"div",className:"admonition-content"},(0,r.mdx)("p",{parentName:"div"},'The name field in the annotation is used to allow multiple range events for a single layout. For example "paginate" becomes ',(0,r.mdx)("inlineCode",{parentName:"p"},"registerPaginateWorkingRange"),"."))))}c.isMDXComponent=!0}}]);