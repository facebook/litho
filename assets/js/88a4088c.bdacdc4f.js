(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{127:function(e,t,i){"use strict";i.r(t),i.d(t,"frontMatter",(function(){return l})),i.d(t,"metadata",(function(){return s})),i.d(t,"toc",(function(){return r})),i.d(t,"default",(function(){return b}));var n=i(3),a=i(7),o=(i(0),i(182)),l={id:"visibility-handling",title:"Visibility Handling"},s={unversionedId:"visibility-handling",id:"visibility-handling",isDocsHomePage:!1,title:"Visibility Handling",description:"Types of Visibility Range",source:"@site/../docs/visibility-handling.md",slug:"/visibility-handling",permalink:"/docs/visibility-handling",editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/visibility-handling.md",version:"current"},r=[{value:"Types of Visibility Range",id:"types-of-visibility-range",children:[]},{value:"Usage",id:"usage",children:[]},{value:"Custom visibility percentage",id:"custom-visibility-percentage",children:[]},{value:"Changing LithoView visibility",id:"changing-lithoview-visibility",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[]}],c={toc:r};function b(e){var t=e.components,i=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},c,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h3",{id:"types-of-visibility-range"},"Types of Visibility Range"),Object(o.b)("p",null,"The framework currently supports six types of Visibility Event:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/VisibleEvent.html"},"Visible Event"),": this event is triggered when at least one pixel of the Component is visible."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/InvisibleEvent.html"},"Invisible Event"),": this event is triggered when the Component no longer has any pixels on the screen."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/FocusedVisibleEvent.html"},"Focused Visible Event"),": this event is triggered when either the Component occupies at least half of the viewport, or, if the Component is smaller than half the viewport, when it is fully visible."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/UnfocusedVisibleEvent.html"},"Unfocused Visible Event"),": this event is triggered when the Component is no longer focused, i.e. it is not fully visible and does not occupy at least half the viewport."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/FullImpressionVisibleEvent.html"},"Full Impression Visible Event"),": If the Component is smaller than the viewport, this event is triggered when the entire Component is visible in the viewport. If the Component is bigger than the viewport, then just covering the viewport won't trigger the event. It will be triggered when all the edges have passed through the viewport once."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/VisibilityChangedEvent.html"},"VisibilityChangedEvent"),": this event is triggered when the visibility of the Component on the screen changes.")),Object(o.b)("h3",{id:"usage"},"Usage"),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"IMPORTANT")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"Visibility ranges require ",Object(o.b)("a",{parentName:"p",href:"/docs/deep-dive/incremental-mount#manual-incremental-mount"},"incremental mount")," to be enabled on the relevant Component."))),Object(o.b)("p",null,"To register visibility event handlers for a component you can follow the same ",Object(o.b)("a",{parentName:"p",href:"/docs/mainconcepts/coordinate-state-actions/events"},"steps")," as for setting any other event handler."),Object(o.b)("p",null,"Here is an example:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'@LayoutSpec\nclass MyLayoutSpec {\n\n  @OnCreateLayout\n  static Component onCreateLayout(ComponentContext c) {\n\n    return Column.create(c)\n        .alignItems(YogaAlign.STRETCH)\n        .child(Text.create(c)\n            .text("This is MY layout spec")\n            .visibleHandler(MyLayout.onTitleVisible(c))\n            .invisibleHandler(MyLayout.onTitleInvisible(c))\n            .focusedHandler(MyLayout.onComponentFocused(c, "someStringParam"))\n            .fullImpressionHandler(MyLayout.onComponentFullImpression(c)))\n            .visibilityChangedHandler(MyLayout.onComponentVisibilityChanged(c))\n        .build();\n  }\n\n  @OnEvent(VisibleEvent.class)\n  static void onTitleVisible(ComponentContext c) {\n    Log.d("VisibilityRanges", "The title entered the Visible Range");\n  }\n\n  @OnEvent(InvisibleEvent.class)\n  static void onTitleInvisible(ComponentContext c) {\n    Log.d("VisibilityRanges", "The title is no longer visible");\n  }\n\n  @OnEvent(FocusedVisibleEvent.class)\n  static void onComponentFocused(\n      ComponentContext c,\n      @Param String stringParam) {\n    Log.d(\n        "VisibilityRanges",\n        "The component is focused with param: " + stringParam);\n  }\n\n  @OnEvent(FullImpressionVisibleEvent.class)\n  static void onComponentFullImpression(ComponentContext c) {\n    Log.d("VisibilityRanges", "The component has logged a full impression");\n  }\n\n  @OnEvent(VisibilityChangedEvent.class)\n  static void onComponentVisibilityChanged(\n      ComponentContext c,\n      @FromEvent int visibleTop,\n      @FromEvent int visibleLeft,\n      @FromEvent int visibleHeight,\n      @FromEvent int visibleWidth,\n      @FromEvent float percentVisibleHeight,\n      @FromEvent float percentVisibleWidth) {\n      Log.d("VisibilityRanges", "The component visible size is " + visibleHeight + "h" + visibleWidth + "w");\n  }\n\n}\n')),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"VisibilityChangedEvents should be used with particular care since they will be dispatched on every frame while scrolling. No heavy work should be done inside the VisibilityChangedEvents handlers. Visible, Invisible, Focused, Unfocused and Full Impression events are the recommended over VisibilityChanged events whenever possible."))),Object(o.b)("h3",{id:"custom-visibility-percentage"},"Custom visibility percentage"),Object(o.b)("p",null,"By default, ",Object(o.b)("inlineCode",{parentName:"p"},"VisibleEvent")," is triggered when at least 1 pixel of the Component is visible. In some cases you may want to listen to custom visibility events and perform an action when the Component is only partially visible.\nYou can specify a ratio of the Component width or height for when the visibility event is dispatched by using ",Object(o.b)("inlineCode",{parentName:"p"},"visibleHeightRatio")," and ",Object(o.b)("inlineCode",{parentName:"p"},"visibleWidthRatio")," props when specifying a visibility handler."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},'@OnCreateLayout\n  static Component onCreateLayout(ComponentContext c) {\n\n    return Column.create(c)\n        .alignItems(YogaAlign.STRETCH)\n        .child(Text.create(c)\n            .text("This is MY layout spec")\n            .visibleHandler(MyLayout.onTitleVisible(c))\n            .visibleHeightRatio(0.8f)\n            .visibleWidthRatio(0.1f)\n        .build();\n}\n')),Object(o.b)("p",null,"For the example above, a VisibilityEvent is dispatched when at least 80% of the Component's height and 10% of the Component's width is visible.\nWhen the Component's visible percentage changes to less than 80% of total height, an invisible event will be dispatched.\nIf not specified, the default width or height ratio is 1f."),Object(o.b)("h3",{id:"changing-lithoview-visibility"},"Changing LithoView visibility"),Object(o.b)("p",null,"There are cases when you need to trigger visibility events on the LithoView components because the UI visibility changed, but the UI did not receive any callback to inform it of this change. An example is when a new activity is added to the back stack, covering the UI. In such cases you can call ",Object(o.b)("inlineCode",{parentName:"p"},"setVisibilityHint")," on the ",Object(o.b)("inlineCode",{parentName:"p"},"LithoView")," to tell the UI whether it is visible or not. You may want to do this when ",Object(o.b)("inlineCode",{parentName:"p"},"Fragment#setUserVisibleHint")," or ",Object(o.b)("inlineCode",{parentName:"p"},"onResume/onPause")," are called."),Object(o.b)("p",null,"Example usage:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-java"},"LithoView.setVisibilityHint(true); // This will dispatch visible/focused events as necessary on all components inside this LithoView\nLithoView.setVisibilityHint(false); // This will dispatch invisible/unfocused events as necessary on all components inside this LithoView\n")),Object(o.b)("p",null,"After calling ",Object(o.b)("inlineCode",{parentName:"p"},"LithoView.setVisibilityHint(false)"),", the LithoView will consider itself not visible and will ignore any requests to mount until ",Object(o.b)("inlineCode",{parentName:"p"},"setVisibilityHint(true)")," is called.\nYou may still unmount the entire LithoView content by calling ",Object(o.b)("inlineCode",{parentName:"p"},"unmountAll")," if the visibility hint was set to false.\nResetting the visibility hint to true after it was set to false will also trigger a mount pass, in case the visible bounds changed while the LithoView was ignoring mount requests."),Object(o.b)("h3",{id:"troubleshooting"},"Troubleshooting"),Object(o.b)("p",null,"If you are not seeing your visibility event fired when you expect it to be, you can take the following steps:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Verify that incremental mount is enabled for your Component. It is enabled by default, but if you turned it off, then visibility events will not be fired."),Object(o.b)("li",{parentName:"ol"},"Verify that you actually set the event that you defined in your spec on your Component (i.e. by calling ",Object(o.b)("inlineCode",{parentName:"li"},"visibleHandler(MyLayout.onTitleVisible(c))")," or similar."),Object(o.b)("li",{parentName:"ol"},"Visibility handlers are fired in ",Object(o.b)("a",{parentName:"li",href:"https://github.com/facebook/litho/blob/master/litho-core/src/main/java/com/facebook/litho/MountState.java#L489:L657"},Object(o.b)("inlineCode",{parentName:"a"},"MountState.processVisibilityOutputs()")),". You can step through this method and see why the event that you expect to be fired is not being fired.")))}b.isMDXComponent=!0},182:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return m}));var n=i(0),a=i.n(n);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var c=a.a.createContext({}),b=function(e){var t=a.a.useContext(c),i=t;return e&&(i="function"==typeof e?e(t):s(s({},t),e)),i},h=function(e){var t=b(e.components);return a.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),h=b(i),d=n,m=h["".concat(l,".").concat(d)]||h[d]||p[d]||o;return i?a.a.createElement(m,s(s({ref:t},c),{},{components:i})):a.a.createElement(m,s({ref:t},c))}));function m(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=i.length,l=new Array(o);l[0]=d;var s={};for(var r in t)hasOwnProperty.call(t,r)&&(s[r]=t[r]);s.originalType=e,s.mdxType="string"==typeof e?e:n,l[1]=s;for(var c=2;c<o;c++)l[c]=i[c];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,i)}d.displayName="MDXCreateElement"}}]);